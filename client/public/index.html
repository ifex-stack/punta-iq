<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>PuntaIQ Predictions</title>
    <!-- Route Recovery Meta Tag - Helps detect when SPA routes need recovery -->
    <meta name="spa-router" content="enabled">
    <!-- PuntaIQ Configuration & Port Detection Script -->
    <script type="text/javascript">
      // Configure PuntaIQ platform
      window.PuntaIQ = window.PuntaIQ || {};
      
      // Detect when a 404 error page is loaded
      function is404Page() {
        return document.title.includes('404') || 
               document.title.includes('Not Found') ||
               (document.body && document.body.textContent && 
                document.body.textContent.includes('Not Found'));
      }
      
      // Record initial load time to help with diagnostics
      window.PuntaIQ.initialLoadTime = Date.now();
      
      // Function to redirect to the correct application URL  
      function redirectToCorrectUrl() {
        // Set the correct API endpoints regardless of port
        window.PuntaIQ.apiBaseUrl = `${window.location.protocol}//${window.location.hostname}:3000`;
        window.PuntaIQ.aiServiceBaseUrl = `${window.location.protocol}//${window.location.hostname}:5000`;
        window.PuntaIQ.aiServiceProxyUrl = `${window.location.protocol}//${window.location.hostname}:3000/ai-service`;
        
        console.log(`PuntaIQ configured - API on port 3000, AI service via proxy.`);
        
        // When we're on port 3000, set document.ready flag to help the app know it's ready
        if (window.location.port === '3000') {
          window.PuntaIQ.ready = true;
          console.log('PuntaIQ ready on correct port');
          
          // Attempt SPA route recovery for paths other than root
          if (window.location.pathname !== "/" && window.location.pathname !== "") {
            console.log(`Attempting SPA route recovery for: ${window.location.pathname}`);
            
            // Store the path to help React router pick it up properly
            sessionStorage.setItem('puntaiq_initial_path', window.location.pathname);
            
            // Record route recovery attempt in debugging info
            window.PuntaIQ.routeRecoveryAttempted = true;
            window.PuntaIQ.initialPath = window.location.pathname;
          }
        }
      }
      
      // Immediate execution
      try {
        redirectToCorrectUrl();
        
        // Enhanced 404 detection and route recovery
        window.addEventListener('DOMContentLoaded', () => {
          if (is404Page()) {
            console.error('404 page detected, attempting recovery...');
            window.location.href = '/';
          }
        });
      } catch (e) {
        console.error('PuntaIQ initialization error:', e);
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>